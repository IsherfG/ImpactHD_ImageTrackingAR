<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  </head>
  <body>
    <a-scene mindar-image="imageTargetSrc: ./targets 5.mind;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-assets>
        <a-asset-item id="customModel" src="./Bunny.glb"></a-asset-item>
        <a-asset-item id="spam" src="./spam.glb"></a-asset-item>
        <a-asset-item id="chocoModel" src="./Choco.glb"></a-asset-item>
        <a-asset-item id="signModel" src="./Sign.glb"></a-asset-item>
        <video id="portfolioVideo" src="./video.mp4" crossorigin="anonymous" playsinline muted autoplay></video>
        <img id="portfolioImage1" src="./image1.png" />
        <img id="button1" src="./NameBack1.png" />
        <img id="button2" src="./NameBack2.png" />
        <audio id="bunnyAudio" src="./music.mp3" crossorigin="anonymous"></audio>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="far: 10000; objects: .clickable">
      </a-camera>

      <!-- Existing model setup for targetIndex: 0 -->
      <a-entity id="animatedModel" mindar-image-target="targetIndex: 0">
        <a-gltf-model id="bunnyModel" src="#customModel" position="0 -0.9 0" scale="0.2 0.2 0.2" rotation="0 0 0" animation-mixer="clip: Waving; loop: once"></a-gltf-model>
        <a-gltf-model src="#chocoModel" position="0 -0.9 0.3" scale="1.5 1.5 1.5" rotation="0 0 0"></a-gltf-model>
        <a-gltf-model src="#signModel" position="0 0.9 -0.1" scale="0.1 0.1 0.1" rotation="0 0 0"></a-gltf-model>
      </a-entity>

<!-- New media setup for targetIndex: 1 with animations and clickable buttons -->
<a-entity mindar-image-target="targetIndex: 1" id="videoTarget" animation-trigger>
  <a-video id="animatedVideo" src="#portfolioVideo" position="-10 0.5 0" rotation="0 0 0" scale="1 0.5 1" muted autoplay></a-video>

  <!-- animatedImage with animation component but autoplay disabled -->
  <a-image id="animatedImage" src="#portfolioImage1" position="-10 -0.7 0" rotation="0 0 0" scale="1.2 1.5 1"
           animation="property: position; to: 1 -0.7 0; easing: easeOutQuad; dur: 1000; autoplay: false">
  </a-image>

  <!-- button1 with click event to trigger animatedImage animation -->
  <a-image id="animatedButton1" src="#button1" position="-10 -0.5 0.1" rotation="0 0 0" scale="0.5 0.2 1" class="clickable">
  </a-image>

  <a-image id="animatedButton2" src="#button2" position="-10 -1 0.1" rotation="0 0 0" scale="0.5 0.2 1" class="clickable"></a-image>

  <a-text id="animatedText1" value="Luxury Chocolate" color="#FFFFFF" position="-10 1 0" align="center"></a-text>
  <a-text id="animatedText2" value="詳細" color="#FFFFFF" position="-10 -0.5 0.2" align="center"></a-text>
  <a-text id="animatedText3" value="ウェブサイト" color="#FFFFFF" position="-10 -1 0" align="center"></a-text>
</a-entity>

      <a-entity mindar-image-target="targetIndex: 2">
        <a-gltf-model src="#spam" position="0 0 0" scale="0.5 0.5 0.5" rotation="0 180 180"></a-gltf-model>
      </a-entity>
    </a-scene>
    </a-scene>

    <script>
      // Component to trigger animations when the target is found
      AFRAME.registerComponent('animation-trigger', {
  init: function () {
    this.el.addEventListener('targetFound', () => {
      // Get the video element and play it if paused
      const video = document.querySelector("#portfolioVideo");
      if (video.paused) {
        video.play(); // Autoplay video on target detection
      }

      // Animate video position
      document.querySelector("#animatedVideo").setAttribute("animation", {
        property: "position",
        to: "0 0.5 0",
        easing: "easeOutQuad",
        dur: 1000,
        delay: 500
      });

      // Animate image position
      document.querySelector("#animatedImage").setAttribute("animation", {
        property: "position",
        to: "1 -0.7 0",
        easing: "easeOutQuad",
        dur: 1000,
        delay: 1000
      });

      // Animate button1 position
      document.querySelector("#animatedButton1").setAttribute("animation", {
        property: "position",
        to: "0 -0.5 0.1",
        easing: "easeOutQuad",
        dur: 1000,
        delay: 1500
      });

      // Animate button2 position
      document.querySelector("#animatedButton2").setAttribute("animation", {
        property: "position",
        to: "0 -1 0.1",
        easing: "easeOutQuad",
        dur: 1000,
        delay: 2000
      });

      // Animate text positions
      document.querySelector("#animatedText1").setAttribute("animation", {
        property: "position",
        to: "0 1 0",
        easing: "easeOutQuad",
        dur: 1000,
        delay: 2500
      });
      document.querySelector("#animatedText2").setAttribute("animation", {
        property: "position",
        to: "1 -0.5 0.2",
        easing: "easeOutQuad",
        dur: 1000,
        delay: 3000
      });
      document.querySelector("#animatedText3").setAttribute("animation", {
        property: "position",
        to: "0 -1 0",
        easing: "easeOutQuad",
        dur: 1000,
        delay: 3500
      });
    });

    this.el.addEventListener('targetLost', () => {
      // Reset video and element positions when target is lost
      document.querySelector("#animatedVideo").setAttribute("position", "-10 0.5 0");
      document.querySelector("#animatedImage").setAttribute("position", "-10 -0.7 0");
      document.querySelector("#animatedButton1").setAttribute("position", "-10 -0.5 0.1");
      document.querySelector("#animatedButton2").setAttribute("position", "-10 -1 0.1");
      document.querySelector("#animatedText1").setAttribute("position", "-10 1 0");
      document.querySelector("#animatedText2").setAttribute("position", "-10 -0.5 0.2");
      document.querySelector("#animatedText3").setAttribute("position", "-10 -1 0");
    });
  }
});
      

      AFRAME.registerComponent('play-video-audio-on-click', {
    init: function () {
      const video = document.querySelector("#portfolioVideo");

      // Play video when the user clicks anywhere on the page
      document.body.addEventListener('click', () => {
        if (video.paused) {
          video.play();
        }
      });
    }
  });

  

    

      AFRAME.registerComponent('sequence-animation', {
        init: function () {
          const model = this.el.querySelector('a-gltf-model');
          const animations = ['Waving', 'Happy', 'Running'];
          let currentAnimation = 0;

          // Start the first animation
          model.setAttribute('animation-mixer', `clip: ${animations[currentAnimation]}; loop: once`);

          model.addEventListener('animation-finished', () => {
            // Move to the next animation in the sequence
            currentAnimation = (currentAnimation + 1) % animations.length;
            model.setAttribute('animation-mixer', `clip: ${animations[currentAnimation]}; loop: once`);
          });
        }
      });


  // Component to play audio on user click
  AFRAME.registerComponent('play-audio-on-click', {
    init: function () {
      const audio = document.querySelector("#bunnyAudio");

      // Play audio on any click on the page
      document.body.addEventListener('click', () => {
        if (audio.paused) {
          audio.currentTime = 0; // Reset to the start
          audio.play();
        }
      });
    }
  });


  AFRAME.registerComponent('trigger-animation-on-click', {
    init: function () {
      const button1 = document.querySelector("#animatedButton1");
      const button2 = document.querySelector("#animatedButton2");
      const animatedImage = document.querySelector("#animatedImage");

      // Add click event listener to button1 to start animation
      button1.addEventListener('click', () => {
        animatedImage.setAttribute("animation", "autoplay", "true");
      });

      // Add click event listener to button2 to redirect to Simply Chocolate website
      button2.addEventListener('click', () => {
        window.open("https://www.simplychocolate.com", "_blank");
      });
    }
  });

  // Attach the component to the scene or target entity
  document.querySelector("#videoTarget").setAttribute("trigger-animation-on-click", "");

  // Attach the audio component to the entity with targetIndex: 0
  document.querySelector('#animatedModel').setAttribute('play-audio-on-target', '');

      // Attach the component to the entity containing Bunny model
      document.querySelector('#animatedModel').setAttribute('sequence-animation', '');

      // Attach components to relevant entities
      document.querySelector('a-scene').setAttribute('play-video-audio-on-click', '');

    </script>
  </body>
</html>